pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building the application'
            }
        }
        stage('Test') {
            steps {
                echo 'Running tests'
            }
            post {
                always {
                    script {
                        emailext (
                            to: 'ajaypanand007@gmail.com',
                            subject: "Jenkins: Tests Stage Result - ${currentBuild.currentResult}",
                            body: """
                            <p>The Test stage completed with status: <b>${currentBuild.currentResult}</b>.</p>
                            <p>Check the attached log for details.</p>
                            """,
                            mimeType: 'text/html',
                            attachmentsPattern: 'build.log'
                        )
                    }
                }
            }
        }
        stage('Security Scan') {
            steps {
                echo 'Running security scan'
            }
            post {
                always {
                    script {
                        emailext (
                            to: 'ajaypanand007@gmail.com',
                            subject: "Jenkins: Security Stage Result - ${currentBuild.currentResult}",
                            body: """
                            <p>The Security stage completed with status: <b>${currentBuild.currentResult}</b>.</p>
                            <p>Check the attached log for details.</p>
                            """,
                            mimeType: 'text/html',
                            attachmentsPattern: 'build.log'
                        )
                    }
                }
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying the application'
            }
        }
    }
}
